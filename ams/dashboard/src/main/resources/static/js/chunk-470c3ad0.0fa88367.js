(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-470c3ad0"],{2460:function(e,t,a){"use strict";a("ce99")},8552:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var o=a("7a23"),c=a("47e2");function l(){const{t:e}=Object(c["b"])(),t=Object(o["computed"])(()=>e("catalog")).value,a=Object(o["computed"])(()=>e("databaseName")).value,l=Object(o["computed"])(()=>e("tableName")).value,r=Object(o["computed"])(()=>e("optimzerGroup")).value,i=Object(o["computed"])(()=>e("resourceGroup")).value,n=Object(o["computed"])(()=>e("parallelism")).value,s=Object(o["computed"])(()=>e("username")).value,u=Object(o["computed"])(()=>e("password")).value,p=Object(o["computed"])(()=>e("database",2)).value,b=Object(o["computed"])(()=>e("table",2)).value;return{selectPh:e("selectPlaceholder"),inputPh:e("inputPlaceholder"),selectClPh:e("selectPlaceholder",{selectPh:t}),selectDBPh:e("selectPlaceholder",{selectPh:a}),inputDBPh:e("inputPlaceholder",{inputPh:a}),inputClPh:e("inputPlaceholder",{inputPh:t}),inputTNPh:e("inputPlaceholder",{inputPh:l}),selectOptGroupPh:e("inputPlaceholder",{inputPh:r}),resourceGroupPh:e("inputPlaceholder",{inputPh:i}),parallelismPh:e("inputPlaceholder",{inputPh:n}),usernamePh:e("inputPlaceholder",{inputPh:s}),passwordPh:e("inputPlaceholder",{inputPh:u}),filterDBPh:e("filterPlaceholder",{inputPh:p}),filterTablePh:e("filterPlaceholder",{inputPh:b})}}},"86c9":function(e,t,a){"use strict";a("f5ea")},b356:function(e,t,a){"use strict";function o(){const e=0,t=1,a=["25","50","100"],o=25;return{total:e,current:t,pageSize:o,pageSizeOptions:a,showQuickJumper:!0,showSizeChanger:!0,hideOnSinglePage:!1}}a.d(t,"a",(function(){return o}))},cac2:function(e,t,a){"use strict";a.r(t);var o=a("7a23");const c={class:"border-wrap"},l={class:"optimize-wrap"},r={class:"optimize-group g-flex-ac"},i={class:"left-group"},n={class:"g-mr-16"},s={class:"btn-wrap"},u={class:"g-ml-16 f-shink-0"},p={class:"text-color"},b={class:"text-color"},d={class:"content"};function m(e,t,a,m,O,j){const h=Object(o["resolveComponent"])("a-select"),f=Object(o["resolveComponent"])("a-button"),v=Object(o["resolveComponent"])("List"),g=Object(o["resolveComponent"])("a-tab-pane"),z=Object(o["resolveComponent"])("a-tabs"),y=Object(o["resolveComponent"])("scale-out-modal");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",c,[Object(o["createElementVNode"])("div",l,[Object(o["createElementVNode"])("div",r,[Object(o["createElementVNode"])("div",i,[Object(o["createElementVNode"])("span",n,Object(o["toDisplayString"])(e.$t("optimzerGroup")),1),Object(o["createVNode"])(h,{value:e.curGroupName,"onUpdate:value":t[0]||(t[0]=t=>e.curGroupName=t),showSearch:!0,options:e.groupList,placeholder:e.placeholder.selectOptGroupPh,onChange:e.onChangeGroup,style:{width:"240px"}},null,8,["value","options","placeholder","onChange"])]),Object(o["createElementVNode"])("div",s,[Object(o["createElementVNode"])("span",u,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.$t("resourceOccupation"))+" ",1),Object(o["createElementVNode"])("span",p,Object(o["toDisplayString"])(e.groupInfo.occupationCore),1),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.$t("core"))+" ",1),Object(o["createElementVNode"])("span",b,Object(o["toDisplayString"])(e.groupInfo.occupationMemory),1),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.groupInfo.unit),1)]),Object(o["createVNode"])(f,{type:"primary",onClick:e.expansionJob,class:"g-ml-8"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.$t("scaleOut")),1)]),_:1},8,["onClick"])])]),Object(o["createElementVNode"])("div",d,[e.showTab?(Object(o["openBlock"])(),Object(o["createBlock"])(z,{key:0,activeKey:e.activeTab,"onUpdate:activeKey":t[1]||(t[1]=t=>e.activeTab=t),destroyInactiveTabPane:"",onChange:e.onChangeTab},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.tabConfig,t=>(Object(o["openBlock"])(),Object(o["createBlock"])(g,{key:t.value,tab:t.label,class:Object(o["normalizeClass"])([e.activeTab===t.value?"active":""])},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(v,{curGroupName:e.curGroupName,type:t.value,onRefreshCurGroupInfo:e.refreshCurGroupInfo},null,8,["curGroupName","type","onRefreshCurGroupInfo"])]),_:2},1032,["tab","class"]))),128))]),_:1},8,["activeKey","onChange"])):Object(o["createCommentVNode"])("",!0)])]),e.showScaleOutModal?(Object(o["openBlock"])(),Object(o["createBlock"])(y,{key:0,visible:e.showScaleOutModal,resourceGroup:"all"===e.curGroupName?"":e.curGroupName,onCancel:t[2]||(t[2]=t=>e.showScaleOutModal=!1),onRefreshOptimizersTab:e.refreshOptimizersTab},null,8,["visible","resourceGroup","onRefreshOptimizersTab"])):Object(o["createCommentVNode"])("",!0)])}var O=a("47e2"),j=a("6c02"),h=a("8552"),f=a("b356"),v=a("b32d");function g(){return v["a"].get("ams/v1/optimize/optimizerGroups")}function z(e){const{optimizerGroup:t,page:a,pageSize:o}=e;return v["a"].get(`ams/v1/optimize/optimizerGroups/${t}/tables`,{params:{page:a,pageSize:o}})}function y(e){const{optimizerGroup:t,page:a,pageSize:o}=e;return v["a"].get(`ams/v1/optimize/optimizerGroups/${t}/optimizers`,{params:{page:a,pageSize:o}})}function C(e){return v["a"].get(`ams/v1/optimize/optimizerGroups/${e}/info`)}function N(e){const{optimizerGroup:t,parallelism:a}=e;return v["a"].post(`ams/v1/optimize/optimizerGroups/${t}/optimizers`,{parallelism:a})}function G(e){const{optimizerGroup:t,jobId:a}=e;return v["a"].delete(`ams/v1/optimize/optimizerGroups/${t}/optimizers/${a}`)}var w=Object(o["defineComponent"])({__name:"ScaleOut",props:{visible:{type:Boolean},resourceGroup:null},emits:["cancel","refreshOptimizersTab"],setup(e,{emit:t}){const a=e,c=Object(o["ref"])(!1),l=Object(o["reactive"])(Object(h["a"])()),r=Object(o["ref"])(),i=Object(o["reactive"])({resourceGroup:a.resourceGroup||void 0,parallelism:1}),n=Object(o["reactive"])([]);async function s(){const e=await g();n.length=0,(e||[]).forEach(e=>{n.push({...e,label:e.optimizerGroupName,value:e.optimizerGroupName})})}function u(){r.value.validateFields().then(async()=>{c.value=!0,await N({optimizerGroup:i.resourceGroup||"",parallelism:Number(i.parallelism)}),r.value.resetFields(),t("cancel"),t("refreshOptimizersTab"),c.value=!1}).catch(()=>{c.value=!1})}function p(){r.value.resetFields(),t("cancel")}return Object(o["onMounted"])(()=>{s()}),(e,t)=>{const s=Object(o["resolveComponent"])("a-select"),b=Object(o["resolveComponent"])("a-form-item"),d=Object(o["resolveComponent"])("a-input"),m=Object(o["resolveComponent"])("a-form"),O=Object(o["resolveComponent"])("a-modal");return Object(o["openBlock"])(),Object(o["createBlock"])(O,{visible:a.visible,title:e.$t("scaleOut"),confirmLoading:c.value,closable:!1,onOk:u,onCancel:p},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(m,{ref_key:"formRef",ref:r,model:i,class:"label-120"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{name:"resourceGroup",label:e.$t("resourceGroup"),rules:[{required:!0,message:""+l.resourceGroupPh}]},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(s,{value:i.resourceGroup,"onUpdate:value":t[0]||(t[0]=e=>i.resourceGroup=e),showSearch:!0,options:n,placeholder:l.resourceGroupPh},null,8,["value","options","placeholder"])]),_:1},8,["label","rules"]),Object(o["createVNode"])(b,{name:"parallelism",label:e.$t("parallelism"),rules:[{required:!0,message:""+l.parallelismPh}]},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(d,{value:i.parallelism,"onUpdate:value":t[1]||(t[1]=e=>i.parallelism=e),type:"number",placeholder:l.parallelismPh},null,8,["value","placeholder"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["visible","title","confirmLoading"])}}});const k=w;var S=k,P=(a("cd17"),a("ed3b")),x=a("d257");const I={class:"list-wrap"},T=["title","onClick"],V=["title"],B=["onClick"];var D=Object(o["defineComponent"])({__name:"List",props:{curGroupName:null,type:null},emits:["refreshCurGroupInfo"],setup(e,{emit:t}){const a=e,{t:c}=Object(O["b"])(),l=Object(j["e"])(),r=Object(o["shallowReactive"])({pending:{title:"pending",color:"#ffcc00"},idle:{title:"idle",color:"#c9cdd4"},minor:{title:"minor",color:"#0ad787"},major:{title:"major",color:"#0ad787"},full:{title:"full",color:"#0ad787"},committing:{title:"committing",color:"#0ad787"}}),i=Object(o["ref"])(!1),n=Object(o["ref"])(!1),s=Object(o["shallowReactive"])([{dataIndex:"tableName",title:c("table"),ellipsis:!0,scopedSlots:{customRender:"tableName"}},{dataIndex:"groupName",title:c("optimizerGroup"),width:"16%",ellipsis:!0},{dataIndex:"optimizeStatus",title:c("optimizingStatus"),width:"16%",ellipsis:!0},{dataIndex:"durationDisplay",title:c("duration"),width:"10%",ellipsis:!0},{dataIndex:"fileCount",title:c("fileCount"),width:"10%",ellipsis:!0},{dataIndex:"fileSizeDesc",title:c("fileSize"),width:"10%",ellipsis:!0},{dataIndex:"quota",title:c("quota"),width:"10%",ellipsis:!0},{dataIndex:"quotaOccupationDesc",title:c("occupation"),width:120,ellipsis:!0}]),u=Object(o["shallowReactive"])([{dataIndex:"index",title:c("order"),width:80,ellipsis:!0},{dataIndex:"groupName",title:c("optimizerGroup"),ellipsis:!0},{dataIndex:"container",title:c("container"),ellipsis:!0},{dataIndex:"jobStatus",title:c("status"),ellipsis:!0},{dataIndex:"resourceAllocation",title:c("resourceAllocation"),width:"20%",ellipsis:!0},{dataIndex:"operation",title:c("operation"),key:"operation",ellipsis:!0,width:160,scopedSlots:{customRender:"operation"}}]),p=Object(o["reactive"])(Object(f["a"])()),b=Object(o["reactive"])([]),d=Object(o["reactive"])([]),m=Object(o["computed"])(()=>"optimizers"===a.type?u:s),h=Object(o["computed"])(()=>"optimizers"===a.type?b:d);function v(e){e&&(p.current=1),"optimizers"===a.type?g():C()}async function g(){try{b.length=0,i.value=!0;const e={optimizerGroup:a.curGroupName,page:p.current,pageSize:p.pageSize},t=await y(e),{list:o,total:l}=t;p.total=l,(o||[]).forEach((e,t)=>{e.resourceAllocation=`${e.coreNumber} ${c("core")} ${Object(x["h"])(e.memory)}`,e.index=(p.current-1)*p.pageSize+t+1,b.push(e)})}catch(e){}finally{i.value=!1}}async function C(){try{d.length=0,i.value=!0;const e={optimizerGroup:a.curGroupName||"",page:p.current,pageSize:p.pageSize},t=await z(e),{list:o,total:c}=t;p.total=c,(o||[]).forEach(e=>{e.quotaOccupationDesc=e.quotaOccupation-5e-4>0?(100*e.quotaOccupation).toFixed(1)+"%":"0",e.durationDesc=Object(x["e"])(e.duration||0),e.durationDisplay=Object(x["d"])(e.duration||0),e.fileSizeDesc=Object(x["a"])(e.fileSize),d.push(e)})}catch(e){}finally{i.value=!1}}function N(e){"external"!==e.containerType&&P["a"].confirm({title:c("releaseOptModalTitle"),content:"",okText:"",cancelText:"",onOk:()=>{w(e)}})}async function w(e){try{n.value=!0,await G({optimizerGroup:e.groupName,jobId:e.jobId}),v(!0),t("refreshCurGroupInfo")}finally{n.value=!1}}function k({current:e=p.current,pageSize:t=p.pageSize}){p.current=e;const a=t!==p.pageSize;p.pageSize=t,v(a)}function S(e){const{catalog:t,database:a,tableName:o}=e.tableIdentifier;l.push({path:"/tables",query:{catalog:t,db:a,table:o}})}return Object(o["watch"])(()=>a.curGroupName,e=>{e&&v()}),Object(o["onMounted"])(()=>{v()}),(e,t)=>{const a=Object(o["resolveComponent"])("a-table"),l=Object(o["resolveComponent"])("u-loading");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createElementVNode"])("div",I,[Object(o["createVNode"])(a,{class:"ant-table-common",columns:Object(o["unref"])(m),"data-source":Object(o["unref"])(h),pagination:p,loading:i.value,onChange:k},{bodyCell:Object(o["withCtx"])(({column:e,record:t})=>["tableName"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,title:t.tableName,class:"primary-link",onClick:e=>S(t)},Object(o["toDisplayString"])(t.tableName),9,T)):Object(o["createCommentVNode"])("",!0),"durationDisplay"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:1,title:t.durationDesc},Object(o["toDisplayString"])(t.durationDisplay),9,V)):Object(o["createCommentVNode"])("",!0),"optimizeStatus"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:2},[Object(o["createElementVNode"])("span",{style:Object(o["normalizeStyle"])({"background-color":(Object(o["unref"])(r)[t.optimizeStatus]||{}).color}),class:"status-icon"},null,4),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.optimizeStatus),1)],64)):Object(o["createCommentVNode"])("",!0),"operation"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:3,class:Object(o["normalizeClass"])(["primary-link",{disabled:"external"===t.containerType}]),onClick:e=>N(t)},Object(o["toDisplayString"])(Object(o["unref"])(c)("release")),11,B)):Object(o["createCommentVNode"])("",!0)]),_:1},8,["columns","data-source","pagination","loading"])]),n.value?(Object(o["openBlock"])(),Object(o["createBlock"])(l,{key:0})):Object(o["createCommentVNode"])("",!0)],64)}}}),E=(a("86c9"),a("6b0d")),_=a.n(E);const $=_()(D,[["__scopeId","data-v-23774148"]]);var M=$,q=Object(o["defineComponent"])({name:"Optimize",components:{List:M,ScaleOutModal:S},setup(){const{t:e}=Object(O["b"])(),t=Object(j["e"])(),a=Object(j["d"])(),c=Object(o["shallowReactive"])([{label:e("optimizers"),value:"optimizers"},{label:e("tables"),value:"tables"}]),l=Object(o["reactive"])(Object(h["a"])()),r=Object(o["reactive"])(Object(f["a"])()),i=Object(o["reactive"])({curGroupName:"all",groupList:[{label:e("allGroups"),value:"all"}],groupInfo:{occupationCore:0,occupationMemory:0,unit:""},activeTab:"tables",showScaleOutModal:!1,showTab:!1}),n=Object(o["computed"])(()=>"tables"===i.activeTab);Object(o["watch"])(()=>a.query,e=>{i.activeTab=e.tab||"tables"},{immediate:!0});const s=()=>{b()},u=()=>{b()},p=async()=>{const e=await g();(e||[]).forEach(e=>{i.groupList.push({label:e.optimizerGroupName,value:e.optimizerGroupName})})},b=async()=>{const e=await C(i.curGroupName||""),t=Object(x["h"])(e.occupationMemory||0),a=t.split(" ");i.groupInfo={occupationCore:e.occupationCore,occupationMemory:a[0],unit:a[1]||""}},d=()=>{i.showScaleOutModal=!0},m=()=>{v("optimizers"),i.showTab=!1,Object(o["nextTick"])(()=>{i.showTab=!0}),b()},v=e=>{const o={...a.query};o.tab=e,t.replace({query:{...o}})};return Object(o["onMounted"])(()=>{i.showTab=!0,p(),b()}),{isTableTab:n,placeholder:l,pagination:r,...Object(o["toRefs"])(i),tabConfig:c,onChangeGroup:s,refreshCurGroupInfo:u,expansionJob:d,refreshOptimizersTab:m,onChangeTab:v}}});a("2460");const R=_()(q,[["render",m],["__scopeId","data-v-f9a0bade"]]);t["default"]=R},ce99:function(e,t,a){},f5ea:function(e,t,a){}}]);