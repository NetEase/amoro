(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-daca9664"],{"0b9b":function(e,t,a){"use strict";a("f834")},"0f26":function(e,t,a){"use strict";a("351a")},"351a":function(e,t,a){},8552:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var o=a("7a23"),r=a("47e2");function c(){const{t:e}=Object(r["b"])(),t=Object(o["computed"])(()=>e("catalog")).value,a=Object(o["computed"])(()=>e("databaseName")).value,c=Object(o["computed"])(()=>e("tableName")).value,n=Object(o["computed"])(()=>e("optimzerGroup")).value,i=Object(o["computed"])(()=>e("resourceGroup")).value,l=Object(o["computed"])(()=>e("parallelism")).value,s=Object(o["computed"])(()=>e("username")).value,u=Object(o["computed"])(()=>e("password")).value,p=Object(o["computed"])(()=>e("database",2)).value,d=Object(o["computed"])(()=>e("table",2)).value;return{selectClPh:e("selectPlaceholder",{selectPh:t}),selectDBPh:e("selectPlaceholder",{selectPh:a}),inputDBPh:e("inputPlaceholder",{inputPh:a}),inputClPh:e("inputPlaceholder",{inputPh:t}),inputTNPh:e("inputPlaceholder",{inputPh:c}),selectOptGroupPh:e("inputPlaceholder",{inputPh:n}),resourceGroupPh:e("inputPlaceholder",{inputPh:i}),parallelismPh:e("inputPlaceholder",{inputPh:l}),usernamePh:e("inputPlaceholder",{inputPh:s}),passwordPh:e("inputPlaceholder",{inputPh:u}),filterDBPh:e("filterPlaceholder",{inputPh:p}),filterTablePh:e("filterPlaceholder",{inputPh:d})}}},b356:function(e,t,a){"use strict";function o(){const e=0,t=1,a=["25","50","100"],o=25;return{total:e,current:t,pageSize:o,pageSizeOptions:a,showQuickJumper:!0,showSizeChanger:!0,hideOnSinglePage:!1}}a.d(t,"a",(function(){return o}))},cac2:function(e,t,a){"use strict";a.r(t);var o=a("7a23");const r={class:"optimize-wrap"},c={class:"optimize-group g-flex-ac"},n={class:"left-group"},i={class:"g-mr-16"},l={class:"btn-wrap"},s={class:"g-ml-16 f-shink-0"},u={class:"text-color"},p={class:"text-color"},d=Object(o["createTextVNode"])(" G "),b={class:"content"};function m(e,t,a,m,O,h){const j=Object(o["resolveComponent"])("a-select"),f=Object(o["resolveComponent"])("a-button"),v=Object(o["resolveComponent"])("List"),g=Object(o["resolveComponent"])("a-tab-pane"),z=Object(o["resolveComponent"])("a-tabs"),y=Object(o["resolveComponent"])("scale-out-modal");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createElementVNode"])("div",r,[Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("div",n,[Object(o["createElementVNode"])("span",i,Object(o["toDisplayString"])(e.$t("optimzerGroup")),1),Object(o["createVNode"])(j,{value:e.curGroupName,"onUpdate:value":t[0]||(t[0]=t=>e.curGroupName=t),showSearch:!0,options:e.groupList,placeholder:e.placeholder.selectOptGroupPh,onChange:e.onChangeGroup,style:{width:"240px"}},null,8,["value","options","placeholder","onChange"])]),Object(o["createElementVNode"])("div",l,[Object(o["createElementVNode"])("span",s,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.$t("resourceOccupation"))+" ",1),Object(o["createElementVNode"])("span",u,Object(o["toDisplayString"])(e.groupInfo.occupationCore),1),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.$t("core"))+" ",1),Object(o["createElementVNode"])("span",p,Object(o["toDisplayString"])(e.groupInfo.occupationMemory),1),d]),Object(o["createVNode"])(f,{type:"primary",onClick:e.expansionJob,class:"g-ml-8"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.$t("scaleOut")),1)]),_:1},8,["onClick"])])]),Object(o["createElementVNode"])("div",b,[Object(o["createVNode"])(z,{activeKey:e.activeTab,"onUpdate:activeKey":t[1]||(t[1]=t=>e.activeTab=t),destroyInactiveTabPane:""},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.tabConfig,t=>(Object(o["openBlock"])(),Object(o["createBlock"])(g,{key:t.value,tab:t.label,class:Object(o["normalizeClass"])([e.activeTab===t.value?"active":""])},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(v,{curGroupName:e.curGroupName,type:t.value,needFresh:e.needFresh},null,8,["curGroupName","type","needFresh"])]),_:2},1032,["tab","class"]))),128))]),_:1},8,["activeKey"])])]),e.showScaleOutModal?(Object(o["openBlock"])(),Object(o["createBlock"])(y,{key:0,visible:e.showScaleOutModal,resourceGroup:"all"===e.curGroupName?"":e.curGroupName,onCancel:t[2]||(t[2]=t=>e.showScaleOutModal=!1),onRefreshOptimizersTab:e.refreshOptimizersTab},null,8,["visible","resourceGroup","onRefreshOptimizersTab"])):Object(o["createCommentVNode"])("",!0)],64)}var O=a("47e2"),h=a("8552"),j=a("b356"),f=a("b32d");function v(){return f["a"].get("ams/v1/optimize/optimizerGroups")}function g(e){const{optimizerGroup:t,page:a,pageSize:o}=e;return f["a"].get(`ams/v1/optimize/optimizerGroups/${t}/tables`,{params:{page:a,pageSize:o}})}function z(e){const{optimizerGroup:t,page:a,pageSize:o}=e;return f["a"].get(`ams/v1/optimize/optimizerGroups/${t}/optimizers`,{params:{page:a,pageSize:o}})}function y(e){return f["a"].get(`ams/v1/optimize/optimizerGroups/${e}/info`)}function w(e){const{optimizerGroup:t,parallelism:a}=e;return f["a"].post(`ams/v1/optimize/optimizerGroups/${t}/optimizers`,{parallelism:a})}function N(e){const{optimizerGroup:t,jobId:a}=e;return f["a"].delete(`ams/v1/optimize/optimizerGroups/${t}/optimizers/${a}`)}a("3b18");var G=a("f64c"),C=Object(o["defineComponent"])({__name:"ScaleOut",props:{visible:{type:Boolean},resourceGroup:null},emits:["cancel","refreshOptimizersTab"],setup(e,{emit:t}){const a=e,r=Object(o["reactive"])(Object(h["a"])()),c=Object(o["ref"])(),n=Object(o["reactive"])({resourceGroup:a.resourceGroup||void 0,parallelism:1}),i=Object(o["reactive"])([]);async function l(){const e=await v();i.length=0,(e||[]).forEach(e=>{i.push({...e,label:e.optimizerGroupName,value:e.optimizerGroupName})})}function s(){c.value.validateFields().then(async()=>{await w({optimizerGroup:n.resourceGroup||"",parallelism:Number(n.parallelism)}),c.value.resetFields(),t("cancel"),t("refreshOptimizersTab")}).catch(e=>{G["a"].error(e.message)})}function u(){c.value.resetFields(),t("cancel")}return Object(o["onMounted"])(()=>{l()}),(e,t)=>{const l=Object(o["resolveComponent"])("a-select"),p=Object(o["resolveComponent"])("a-form-item"),d=Object(o["resolveComponent"])("a-input"),b=Object(o["resolveComponent"])("a-form"),m=Object(o["resolveComponent"])("a-modal");return Object(o["openBlock"])(),Object(o["createBlock"])(m,{visible:a.visible,title:e.$t("scaleOut"),onOk:s,onCancel:u},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{ref_key:"formRef",ref:c,model:n,class:"label-120"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p,{name:"resourceGroup",label:e.$t("resourceGroup"),rules:[{required:!0,message:""+r.resourceGroupPh}]},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{value:n.resourceGroup,"onUpdate:value":t[0]||(t[0]=e=>n.resourceGroup=e),showSearch:!0,options:i,placeholder:r.resourceGroupPh},null,8,["value","options","placeholder"])]),_:1},8,["label","rules"]),Object(o["createVNode"])(p,{name:"parallelism",label:e.$t("parallelism"),rules:[{required:!0,message:""+r.parallelismPh}]},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(d,{value:n.parallelism,"onUpdate:value":t[1]||(t[1]=e=>n.parallelism=e),type:"number",placeholder:r.parallelismPh},null,8,["value","placeholder"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["visible","title"])}}});const S=C;var x=S,P=(a("cd17"),a("ed3b")),k=a("d257"),M=a("6c02");const T={class:"list-wrap"},B=["onClick"],I=["title"],V=["onClick"];var D=Object(o["defineComponent"])({__name:"List",props:{curGroupName:null,type:null,needFresh:{type:Boolean}},setup(e){const t=e,{t:a}=Object(O["b"])(),r=Object(M["d"])(),c=Object(o["ref"])(!1),n=Object(o["shallowReactive"])([{dataIndex:"tableName",title:a("table"),ellipsis:!0,scopedSlots:{customRender:"tableName"}},{dataIndex:"optimizeStatus",title:a("status"),width:"14%",ellipsis:!0},{dataIndex:"durationDisplay",title:a("duration"),width:"16%",ellipsis:!0},{dataIndex:"fileCount",title:a("fileCount"),width:"10%",ellipsis:!0},{dataIndex:"fileSizeDesc",title:a("fileSize"),width:"10%",ellipsis:!0},{dataIndex:"quota",title:a("quota"),width:"10%",ellipsis:!0},{dataIndex:"quotaOccupationDesc",title:a("quotaOccupation"),width:"20%",ellipsis:!0}]),i=Object(o["shallowReactive"])([{dataIndex:"index",title:a("order"),width:80,ellipsis:!0},{dataIndex:"groupName",title:a("optimizerGroup"),ellipsis:!0},{dataIndex:"container",title:a("container"),ellipsis:!0},{dataIndex:"jobStatus",title:a("status"),ellipsis:!0},{dataIndex:"resourceAllocation",title:a("resourceAllocation"),width:"20%",ellipsis:!0},{dataIndex:"operation",title:a("operation"),key:"operation",ellipsis:!0,width:160,scopedSlots:{customRender:"operation"}}]),l=Object(o["reactive"])(Object(j["a"])()),s=Object(o["reactive"])([]),u=Object(o["reactive"])([]),p=Object(o["computed"])(()=>"optimizers"===t.type?i:n),d=Object(o["computed"])(()=>"optimizers"===t.type?s:u);function b(e){e&&(l.current=1),"optimizers"===t.type?m():h()}async function m(){try{s.length=0,c.value=!0;const e={optimizerGroup:t.curGroupName,page:l.current,pageSize:l.pageSize},o=await z(e),{list:r,total:n}=o;l.total=n,(r||[]).forEach((e,t)=>{e.resourceAllocation=`${e.coreNumber}${a("core")} ${Object(k["f"])(e.memory)}`,e.index=(l.current-1)*l.pageSize+t+1,s.push(e)})}catch(e){}finally{c.value=!1}}async function h(){try{u.length=0,c.value=!0;const e={optimizerGroup:t.curGroupName||"",page:l.current,pageSize:l.pageSize},a=await g(e),{list:o,total:r}=a;l.total=r,(o||[]).forEach(e=>{e.quotaOccupationDesc=e.quotaOccupation?100*e.quotaOccupation+"%":"0",e.durationDesc=Object(k["e"])(e.duration||0),e.durationDisplay=Object(k["d"])(e.duration||0),e.fileSizeDesc=Object(k["a"])(e.fileSize),u.push(e)})}catch(e){}finally{c.value=!1}}function f(e){P["a"].confirm({title:a("releaseOptModalTitle"),content:"",okText:"",cancelText:"",onOk:()=>{v(e)}})}async function v(e){await N({optimizerGroup:e.groupName,jobId:e.jobId}),b(!0)}function y({current:e=l.current,pageSize:t=l.pageSize}){l.current=e;const a=t!==l.pageSize;l.pageSize=t,b(a)}function w(e){const{catalog:t,database:a,tableName:o}=e.tableIdentifier;r.push({path:"/tables",query:{catalog:t,db:a,table:o}})}return Object(o["watch"])(()=>t.curGroupName,e=>{e&&b()}),Object(o["watch"])(()=>t.needFresh,e=>{e&&b(!0)}),Object(o["onMounted"])(()=>{b()}),(e,t)=>{const r=Object(o["resolveComponent"])("a-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",T,[Object(o["createVNode"])(r,{class:"ant-table-common",columns:Object(o["unref"])(p),"data-source":Object(o["unref"])(d),pagination:l,loading:c.value,onChange:y},{bodyCell:Object(o["withCtx"])(({column:e,record:t})=>["tableName"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:"primary-link",onClick:e=>w(t)},Object(o["toDisplayString"])(t.tableName),9,B)):Object(o["createCommentVNode"])("",!0),"durationDisplay"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:1,title:t.durationDesc},Object(o["toDisplayString"])(t.durationDisplay),9,I)):Object(o["createCommentVNode"])("",!0),"operation"===e.dataIndex?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:2,class:"primary-link",onClick:e=>f(t)},Object(o["toDisplayString"])(Object(o["unref"])(a)("release")),9,V)):Object(o["createCommentVNode"])("",!0)]),_:1},8,["columns","data-source","pagination","loading"])])}}}),E=(a("0f26"),a("d959")),F=a.n(E);const _=F()(D,[["__scopeId","data-v-4342c9a3"]]);var $=_,q=Object(o["defineComponent"])({name:"Optimize",components:{List:$,ScaleOutModal:x},setup(){const{t:e}=Object(O["b"])(),t=Object(o["shallowReactive"])([{label:e("tables"),value:"tables"},{label:e("optimizers"),value:"optimizers"}]),a=Object(o["reactive"])(Object(h["a"])()),r=Object(o["reactive"])(Object(j["a"])()),c=Object(o["reactive"])({curGroupName:"all",groupList:[{label:e("allGroups"),value:"all"}],groupInfo:{occupationCore:0,occupationMemory:0},activeTab:"tables",showScaleOutModal:!1,needFresh:!1}),n=Object(o["computed"])(()=>"tables"===c.activeTab),i=()=>{s()},l=async()=>{const e=await v();(e||[]).forEach(e=>{c.groupList.push({label:e.optimizerGroupName,value:e.optimizerGroupName})})},s=async()=>{const e=await y(c.curGroupName||"");c.groupInfo={...e}},u=()=>{c.showScaleOutModal=!0},p=()=>{c.activeTab="optimizers",c.needFresh=!0};return Object(o["onMounted"])(()=>{l(),s()}),{isTableTab:n,placeholder:a,pagination:r,...Object(o["toRefs"])(c),tabConfig:t,onChangeGroup:i,expansionJob:u,refreshOptimizersTab:p}}});a("0b9b");const R=F()(q,[["render",m],["__scopeId","data-v-2663af00"]]);t["default"]=R},d257:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"f",(function(){return r})),a.d(t,"e",(function(){return c})),a.d(t,"d",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return l}));const o=e=>{if(0===e)return"0";if(null===e||void 0===e)return"未知";const t=1024;return e<t?e+"B":e<Math.pow(t,2)?(e/t).toFixed(2)+"KB":e<Math.pow(t,3)?(e/Math.pow(t,2)).toFixed(2)+"MB":e<Math.pow(t,4)?(e/Math.pow(t,3)).toFixed(2)+"G":(e/Math.pow(t,4)).toFixed(2)+"T"},r=e=>{if(0===e)return"0";const t=1024;return e<t?e+"MB":e<Math.pow(t,2)?(e/t).toFixed(2)+"G":(e/Math.pow(t,2)).toFixed(2)+"T"},c=(e,t)=>{if(null===e||void 0===e||isNaN(e))return"";const a=1e3,o=60*a,r=60*o,n=24*r;if(0===e)return"0 ms";if(e<a)return(t?"0 min ":"")+e+" ms";if(e>=a&&e<o){const o=Math.floor(e/a);return(t?"0 min ":"")+(o?o+" s":"")}if(e>=o&&e<r){const t=Math.floor(e/o),r=Math.floor((e-t*o)/a);return e%o===0?e/o+" min":t+" min "+(r?r+" s":"")}if(e%r===0)return e/r+" h";if(e>=r&&e<n){const t=Math.floor(e/r);return t+" h "+c(e-t*r,!0)}if(e%n===0)return e/n+" d";const i=Math.floor(e/n);return i+" d "+c(e-i*n,!0)},n=e=>{if(null===e||void 0===e||isNaN(e))return"";const t=1e3,a=60*t,o=60*a,r=24*o;return 0===e?"0 ms":e<=o?Math.floor(e/t)+"s":e>o&&e<=r?Math.floor(e/a)+"min":e>r&&e<=30*r?Math.floor(e/o)+"h":">30d"},i=(()=>{const e=function(e){const t=e||"";return t.length<2?"0"+t:t},t={yyyy:e=>e.getFullYear(),MM:t=>e(String(t.getMonth()+1)),dd:t=>e(String(t.getDate())),HH:t=>e(String(t.getHours())),mm:t=>e(String(t.getMinutes())),ss:t=>e(String(t.getSeconds()))},a=new RegExp(Object.keys(t).join("|"),"g");return function(e,o="yyyy-MM-dd  HH:mm:ss"){if(!e)return"";let r=+e;return r=new Date(r),o.replace(a,e=>t[e](r))}})();function l(e,t=300){let a;return(...o)=>{clearTimeout(a),a=setTimeout(()=>{e.apply(this,o)},t)}}},f834:function(e,t,a){}}]);