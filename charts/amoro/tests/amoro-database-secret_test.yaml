suite: Test Amoro Database Secret
templates:
  - amoro-database-secret.yaml
chart:
  appVersion: 0.1.0
  version: 0.6.0
tests:
  - it: Amoro database secret should not exist when database type set to derby
    set:
      amoroConf:
        database:
          type: derby
    asserts:
      - hasDocuments:
          count: 0
  - it: Amoro database secret should exist when database type set to mysql
    set:
      fullnameOverride: test
      amoroConf:
        database:
          type: mysql
          username: "abc"
          password: "123"
    asserts:
      - containsDocument:
          kind: Secret
          apiVersion: v1
          name: test
      - hasDocuments:
          count: 1
  - it: Amoro database secret should exist when database type set to postgres
    set:
      fullnameOverride: test
      amoroConf:
        database:
          type: postgres
          username: "abc"
          password: "123"
    asserts:
      - containsDocument:
          kind: Secret
          apiVersion: v1
          name: test
      - hasDocuments:
          count: 1
  - it: Amoro database secret should reflect username when database type set to mysql
    set:
      amoroConf:
        database:
          type: mysql
          username: "abc"
          password: "123"
    asserts:
      - equal:
          path: data.username
          value: "abc"
          decodeBase64: true
  - it: Amoro database secret should reflect password when database type set to mysql
    set:
      amoroConf:
        database:
          type: mysql
          username: "abc"
          password: "123"
    asserts:
      - equal:
          path: data.password
          value: "123"
          decodeBase64: true